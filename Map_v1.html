<!DOCTYPE html>
<!–– -->
<html>

<head>
    <title>>OS Open Zoomstack</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/leaflet.css" />
    <link href='https://api.mapbox.com/mapbox-gl-js/v1.11.0/mapbox-gl.css' rel='stylesheet' />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/themes/base/jquery-ui.css" type="text/css" media="all" />
    <link href="plugins/leaflet-custom-searchbox/dist/searchbox.min.css" rel="stylesheet" />
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
</head>
<body>

<div id="map"></div>


<!–– Reference all sources -->
<script src="https://api.tiles.mapbox.com/mapbox-gl-js/v0.46.0/mapbox-gl.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/leaflet.js"></script>
<script src="https://rawgit.com/mapbox/mapbox-gl-leaflet/master/leaflet-mapbox-gl.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/jquery-ui.min.js" type="text/javascript"></script>
<script src="plugins/leaflet-custom-searchbox/dist/leaflet.customsearchbox.min.js"></script>

<script src="Processed_Pharmacies.js"></script>
<script src="Processed_Dentists.js"></script>
<script src="Processed_GPs.js"></script>
<script src="Processed_Hospitals.js"></script>
<script src="Processed_Opticians.js"></script>
<script src="Processed_SHClinics.js"></script>

<!–– Script for map containing javascript code begins -->

<script>

// Establish base map using Ordnance Survey Zoomstack, and Mapbox-GL-Leaflet plugin

var map = L.map('map', {
minZoom: 7,
maxZoom: 18,
maxBounds: [[ 49.84 , -8.74 ], [ 60.9, 1.96 ]]
});

var gl = L.mapboxGL({
style: 'https://s3-eu-west-1.amazonaws.com/tiles.os.uk/v2/styles/open-zoomstack-light/style.json',
accessToken: 'no-token'
}).addTo(map);
map.zoomControl.setPosition('topright');
map.attributionControl.addAttribution('Contains OS data &copy; Crown copyright and database rights 2018');
map.setView([ 55.8652, -4.45 ], 10);


// Locate the user

map.locate({setView: true, maxZoom: 16});
function onLocationFound(e) {
    var radius = e.accuracy;
    
    var locationMarker = {
        radius: 6,
        fillColor: "#2392FF",
        color: "#111",
        weight: 2,
        opacity: 0,
        fillOpacity: 0.8
    };

    var accuracyMarker = {
        radius: radius,
        fillColor: "#2392FF",
        color: "#111",
        weight: 1,
        opacity: 0,
        fillOpacity: 0.1
    };

    L.circle(e.latlng, accuracyMarker).addTo(map);

    L.circleMarker(e.latlng, locationMarker).addTo(map);

}

map.on('locationfound', onLocationFound);


// create a function for pop up information 

function onEachFeature(feature, layer) {
    layer.bindPopup(feature.properties.Name + "<br>" + feature.properties.Address1 + "<br>" + feature.properties.Postcode + "<br>" + feature.properties.Telephone);
}

// create a function for styling points and adding them to the map

function addPoints(service, colour) {

    var geojsonMarker = {
    radius: 8,
    fillColor: colour,
    color: "#000",
    weight: 1,
    opacity: 1,
    fillOpacity: 0.8
    };

    L.geoJSON(service, {
        onEachFeature: onEachFeature,
        pointToLayer: function (feature, latlng) {
            return L.circleMarker(latlng, geojsonMarker);
        }
    }).addTo(map);
}




//addPoints(GPs)/addPoints(Opticians, "#ff2200")
//addPoints(Dentists, "#66ccff")
//addPoints(GPs, "#aa2233")
//addPoints(Hospitals, "#33cc33")
addPoints(Pharmacies, "#ffff00")
//addPoints(Dentists, "#6600cc")


$(document).ready(function () {
	    
        var searchboxControl=createSearchboxControl();
        var control = new searchboxControl({
            sidebarTitleText: 'Header',
            sidebarMenuItems: {
                Items: [
                    { type: "link", name: "Link 1 (github.com)", href: "http://github.com", icon: "icon-local-carwash" },
                    { type: "link", name: "Link 2 (google.com)", href: "http://google.com", icon: "icon-cloudy" },
                    { type: "button", name: "Button 1", onclick: "alert('button 1 clicked !')", icon: "icon-potrait" },
                    { type: "button", name: "Button 2", onclick: "button2_click();", icon: "icon-local-dining" },
                    { type: "link", name: "Link 3 (stackoverflow.com)", href: 'http://stackoverflow.com', icon: "icon-bike" },
                ]
            }
        });
        control._searchfunctionCallBack = function (searchkeywords)
        {
            if (!searchkeywords) {
                searchkeywords = "The search call back is clicked !!"
            }
            alert(searchkeywords);
        }
        map.addControl(control);
    });
    
    function button2_click()
    {
        alert('button 2 clicked !!!');
    }
</script>

</body>
</html>