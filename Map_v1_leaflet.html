<!DOCTYPE html>
<!–– -->
<html>

<head>
    <title>Health Service Finder</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/leaflet.css" />
    <link href='https://api.mapbox.com/mapbox-gl-js/v1.11.0/mapbox-gl.css' rel='stylesheet' />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/themes/base/jquery-ui.css" type="text/css" media="all" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-geosearch@3.0.0/dist/geosearch.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.css" />
    <link rel="stylesheet" href="Plugins/sidebar-v2/css/leaflet-sidebar.css" />

    <style>
        body { margin:10; padding:10; }
        
        h1 {
	    text-align: center;
        }

        /* The popup form - hidden by default */
        .form-popup {
        display: true;
        position: fixed;
        right: 70%;
        top: 20%;
        border: none;
        z-index: 9;
        }

        /* Add styles to the form container */
        .form-container {
        padding: 10px;
        background-color: white;
        vertical-align: middle;
        right: 30%;
        left: 30%;
        top: 20%;
        height:100%;
        }


        /* Set a style for the submit/login button */
        .form-container .btn {
        background-color: navy;
        color: white;
        padding: 16px 20px;
        border: none;
        cursor: pointer;
        width: 100%;
        height: 100%;
        margin-bottom:10px;
        opacity: 0.8;
        vertical-align: middle;
        font-size: 16px;
        }


        /* Add some hover effects to buttons */
        .form-container .btn:hover, .open-button:hover {
        opacity: 1;
        }
        
        #map { position:absolute; top:0; bottom:0; left:0; width: 100%; }
        .custom .leaflet-popup-tip,
        .custom .leaflet-popup-content-wrapper {
            background: #ffffff;
            color: #09325C;
        }

    </style>
</head>

<body>
    <!--
    <div class="form-popup" id="myForm">
        <div class="form-container">
        
          <h4>Please choose which service you are looking for today</h4>
          <p></p>
          <button type="button" class="btn GPs"><onclick="showLayer()">General Practitioner</button>
          <p></p>
          <button type="button" class="btn Dentist"><onclick="closeForm()">Dentist</button>
          <p></p>
          <button type="button" class="btn Optician"><onclick="closeForm()">Optician</button>
          <p></p>
          <button type="button" class="btn Pharmacy"><onclick="closeForm()">Pharmacy</button>
          <p></p>
          <button type="button" class="btn Hospital"><onclick="closeForm()">Hospital</button>
          <p></p>
          <button type="button" class="btn SHClinic"><onclick="closeForm()">Sexual Health Clinic</button>
          <p></p>
          <button type="button" class="btn all"><onclick="closeForm()">ShowAll</button>

        </div>
    </div>
    -->

    <div id="sidebar" class="sidebar collapsed">
        
        
        <div class="sidebar-tabs">
            <ul role="tablist">
                <li><a href="#home" role="tab"><i class="fa fa-info"></i></a></li>
                <li><a href="#GPs" role="tab"><i class="fa fa-user-md"></i></a></li>
                <li><a href="#Dentists" role="tab"><i class="fa fa-envelope"></i></a></li>
                <li><a href="https://github.com/Turbo87/sidebar-v2" role="tab" target="_blank"><i class="fa fa-github"></i></a></li>
            </ul>

            <ul role="tablist">
                <li><a href="#settings" role="tab"><i class="fa fa-gear"></i></a></li>
            </ul>
        </div>

         
        <div class="sidebar-content">
            <div class="sidebar-pane" id="home">
                <h1 class="sidebar-header">
                    Health Service Finder
                    <span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
                </h1>

                <p>A responsive sidebar for mapping libraries like <href onclick="http://leafletjs.com/">Leaflet or <a href="http://openlayers.org/">OpenLayers</a>.</p>

            </div>

            <div class="sidebar-pane" id="profile">
                <h1 class="sidebar-header">Profile<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
            </div>

            <div class="sidebar-pane" id="GPs">
                <h1 class="sidebar-header">GPs<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
            </div>

            <div class="sidebar-pane" id="settings">
                <h1 class="sidebar-header">Settings<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
            </div>
        </div>
    </div>
   

    <div id="map" class="sidebar-map"></div>

    <!–– Reference all sources -->

    <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v0.46.0/mapbox-gl.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/leaflet.js"></script>
    <script src="https://rawgit.com/mapbox/mapbox-gl-leaflet/master/leaflet-mapbox-gl.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/jquery-ui.min.js" type="text/javascript"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script src="https://unpkg.com/leaflet-geosearch@3.0.0/dist/geosearch.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.js" charset="utf-8"></script>
    <script src="Plugins/sidebar-v2/js/leaflet-sidebar.js"></script>



    <script src="2020_07_07_Processed_Pharmacies.js"></script>
    <script src="2020_07_07_Processed_Dentists.js"></script>
    <script src="2020_07_07_Processed_GPs.js"></script>
    <script src="2020_07_07_Processed_Hospitals.js"></script>
    <script src="2020_07_07_Processed_Opticians.js"></script>
    <script src="2020_07_07_Processed_SHClinics.js"></script>
    <script src="mappolygon.js"></script>
    <!–– Script for map containing javascript code begins -->

    <script>




    // Establish base map using Ordnance Survey Zoomstack, and Mapbox-GL-Leaflet plugin

    var basemapLayers = L.layerGroup();

    var light_basemap = L.mapboxGL({
    style: 'https://s3-eu-west-1.amazonaws.com/tiles.os.uk/v2/styles/open-zoomstack-light/style.json',
    accessToken: 'no-token'
    });

    var night_basemap = L.mapboxGL({
    style: 'https://s3-eu-west-1.amazonaws.com/tiles.os.uk/v2/styles/open-zoomstack-night/style.json',
    accessToken: 'no-token'
    })

    var outdoor_basemap = L.mapboxGL({
    style: 'https://s3-eu-west-1.amazonaws.com/tiles.os.uk/v2/styles/open-zoomstack-outdoor/style.json',
    accessToken: 'no-token'
    })

    var roads_basemap = L.mapboxGL({
    style: 'https://s3-eu-west-1.amazonaws.com/tiles.os.uk/v2/styles/open-zoomstack-road/style.json',
    accessToken: 'no-token'
    })

    // store base maps in group
    var baseMaps = {
        "Light": light_basemap,
        "Night": night_basemap,
        "Outdoors": outdoor_basemap,
        "Road" : roads_basemap
    };

    // store each service in layer group
    var Opticians_layer = L.layerGroup(),
        GPs_layer = L.layerGroup(),
        Dentists_layer = L.layerGroup(),
        SHClinics_layer = L.layerGroup(),
        Pharmacies_layer = L.layerGroup(),
        Hospitals_layer = L.layerGroup();

    // initialise map with max and min zoom, max bounds and the default basemap layer
    var map = L.map('map', {
    minZoom: 7,
    maxZoom: 18,
    maxBounds: [[ 49.84 , -8.74 ], [ 60.9, 1.96 ]],
    layers: [outdoor_basemap]
    });


    // Add a search bar to the map
    L.Control.geocoder({
        position: 'topleft'
    }).addTo(map);

    // add zoom control to the map
    map.zoomControl.setPosition('bottomright');

    // add attribution to the map
    map.attributionControl.addAttribution('Contains OS data &copy; Crown copyright and database rights 2018');

    // set the initial view of the map to Glasgow area
    map.setView([ 55.8652, -4.45 ], 10);

    // add user location to the map
    var lc = L.control.locate({
        options: {
            circleStyle: {
                fillOpacity: 0
            },
            keepCurrentZoomLevel: true,
            flyTo: true
        }
    }).addTo(map);

    // store user coordinates
    function onLocationfound(e) {
        var user_location = e.latlng;
        console.log(user_location);
    }


    map.on('locationfound', onLocationfound);

    // ask user location on map load
    lc.start();

    // load polygon on the map and grey out areas around Greater Glasgow and Clyde
    var GGandC_poly = L.geoJSON(mappolygons, {
        style: {
            "color": "#808080",
            "weight": 0,
            "fill": true
        }
    }).addTo(map);

    // create custom options for pop up information
    var customOptions =
            {
            'maxWidth': '200',
            'className' : 'custom'
            }

    // create a function for what to do for each feature        
    function onEachFeature(feature, layer) {
        
        if (layerName = Opticians_layer) {
            layer.bindPopup(feature.properties.Name + "<br>" + feature.properties.Address1 + "<br>" + feature.properties.Postcode + "<br>" + feature.properties.Telephone, customOptions);
        } else {
            layer.bindPopup(feature.properties.Name);
        }

    }


    /*
    // create a function for styling points and adding them to the map
    function addPoints(service, layerName, figureURL, popup_list) {
        
        // add icons for the services and style them appropriately
        var mapIcon = L.icon({
            iconUrl: figureURL,
            iconSize: [30, 30],
            iconAnchor: [15,15],
            popupAnchor: [0, -15],
        });

        // add the geoJSON files to the defined layer groups and run the on each feature function
        L.geoJSON(service, {
            onEachFeature: onEachFeature,
            pointToLayer: function (feature, latlng) {
                return L.marker(latlng, {icon: mapIcon});
            }
        }).addTo(layerName);
    }*/

    
    // create a function for styling points and adding them to the map
    function addIcon(figureURL) {
        // add icons for the services and style them appropriately
        var mapIcon = L.icon({
            iconUrl: figureURL,
            iconSize: [30, 30],
            iconAnchor: [15,15],
            popupAnchor: [0, -15],
        });
    }



        // add the geoJSON files to the defined layer groups and run the on each feature function
    L.geoJSON(GPs, {
        onEachFeature: function(feature, layer) {
            layer.bindPopup("<h2>"+ feature.properties.Name + "</h2>" + feature.properties.Address1 + 
            "<br>" + feature.properties.Postcode + "<br><br>" + "Telephone: <a href=tel:"+ feature.properties.Telephone+ ">" + feature.properties.Telephone+"</a>" + "<br><br><b>Opening Times</b><br>Monday: " + 
            feature.properties.Monday + "<br>Tuesday: " + feature.properties.Tuesday + "<br>Wednesday: " + feature.properties.Wednesday + 
            "<br>Thursday: " + feature.properties.Thursday + "<br>Friday: " + feature.properties.Friday + "<br> " + feature.properties.ExtraOTInfo
            + "<br><br><a href=" + feature.properties.Website + " target=_blank>Visit Website</a>"  + "<br><br><a href=https://www.google.com/maps/dir//" + ((feature.properties.Postcode).replace(/\s+/g, '')) + " target=_blank>Get Directions</a>", customOptions);
        },
        pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {icon: L.icon({
                                            iconUrl: 'MapFigures/GPs.png',
                                            iconSize: [30, 30],
                                            iconAnchor: [15,15],
                                            popupAnchor: [0, -15]
            })
        });
        }
    }).addTo(GPs_layer);
    
    L.geoJSON(Dentists, {
        onEachFeature: function(feature, layer) {
            layer.bindPopup(feature.properties.Name + "<br>" + feature.properties.Address1 + "<br>" + feature.properties.Postcode + "<br>" + feature.properties.Telephone + "<br>Monday:" + feature.properties.Monday, customOptions);
        },
        pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {icon: L.icon({
                                            iconUrl: 'MapFigures/Dentists.png',
                                            iconSize: [30, 30],
                                            iconAnchor: [15,15],
                                            popupAnchor: [0, -15]
            })
        });
        }
    }).addTo(Dentists_layer);

    L.geoJSON(Opticians, {
        onEachFeature: function(feature, layer) {
            layer.bindPopup(feature.properties.Name + "<br>" + feature.properties.Address1 + "<br>" + feature.properties.Postcode + "<br>" + feature.properties.Telephone, customOptions);
        },
        pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {icon: L.icon({
                                            iconUrl: 'MapFigures/Opticians.png',
                                            iconSize: [30, 30],
                                            iconAnchor: [15,15],
                                            popupAnchor: [0, -15]
            })
        });
        }
    }).addTo(Opticians_layer);

    L.geoJSON(Pharmacies, {
        onEachFeature: function(feature, layer) {
            layer.bindPopup(feature.properties.Name + "<br>" + feature.properties.Address1 + "<br>" + feature.properties.Postcode + "<br>" + feature.properties.Telephone, customOptions);
        },
        pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {icon: L.icon({
                                            iconUrl: 'MapFigures/Pharmacies.png',
                                            iconSize: [30, 30],
                                            iconAnchor: [15,15],
                                            popupAnchor: [0, -15]
            })
        });
        }
    }).addTo(Pharmacies_layer);

    L.geoJSON(Hospitals, {
        onEachFeature: function(feature, layer) {
            layer.bindPopup(feature.properties.Name + "<br>" + feature.properties.Address1 + "<br>" + feature.properties.Postcode + "<br>" + feature.properties.Telephone, customOptions);
        },
        pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {icon: L.icon({
                                            iconUrl: 'MapFigures/Hospitals.png',
                                            iconSize: [30, 30],
                                            iconAnchor: [15,15],
                                            popupAnchor: [0, -15]
            })
        });
        }
    }).addTo(Hospitals_layer);

    L.geoJSON(SHClinics, {
        onEachFeature: function(feature, layer) {
            layer.bindPopup(feature.properties.Name + "<br>" + feature.properties.Address1 + "<br>" + feature.properties.Postcode + "<br>" + feature.properties.Telephone, customOptions);
        },
        pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {icon: L.icon({
                                            iconUrl: 'MapFigures/SHClinics.png',
                                            iconSize: [30, 30],
                                            iconAnchor: [15,15],
                                            popupAnchor: [0, -15]
            })
        });
        }
    }).addTo(SHClinics_layer);
    /*
    // run the add Points function for each service
    addPoints(Opticians, Opticians_layer, 'MapFigures/Opticians.png', ['Name', 'Address1', 'Monday', 'Tuesday'])
    addPoints(Dentists, Dentists_layer, 'MapFigures/Dentists.png')
    addPoints(GPs, GPs_layer, 'MapFigures/GPs.png')
    addPoints(Hospitals, Hospitals_layer, 'MapFigures/Hospitals.png')
    addPoints(Pharmacies, Pharmacies_layer, 'MapFigures/Pharmacies.png')
    addPoints(SHClinics, SHClinics_layer, 'MapFigures/SHClinics.png')
    */

    // store layers in overlay group
    var overlayMaps = {
        "GPs": GPs_layer,
        "Dentists" : Dentists_layer,
        "Pharmacies": Pharmacies_layer,
        "Opticians": Opticians_layer,
        "Hospitals": Hospitals_layer,
        "Sexual Health Clinics": SHClinics_layer
    };
        

    // add a legend control for the overlay maps and the base maps to allow users to swap between services 
    L.control.layers(overlayMaps,null,{collapsed:false}).addTo(map);
    L.control.layers(baseMaps).addTo(map);

    // add responsive side bar to the map
    var sidebar = L.control.sidebar('sidebar').addTo(map);

    </script>

    </body>
</html>