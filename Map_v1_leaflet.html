<!DOCTYPE html>
<!–– -->
<html>

<head>
    <title>Health Service Finder</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/leaflet.css" />
    <link href='https://api.mapbox.com/mapbox-gl-js/v1.11.0/mapbox-gl.css' rel='stylesheet' />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/themes/base/jquery-ui.css" type="text/css" media="all" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-geosearch@3.0.0/dist/geosearch.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.css" />
    <link rel="stylesheet" href="Plugins/sidebar-v2/css/leaflet-sidebar.css" />

    <style>
        body { margin:10; padding:10; }
        #map { position:absolute; top:20%; bottom:0; left:30%; width: 70%; }
        .custom .leaflet-popup-tip,
        .custom .leaflet-popup-content-wrapper {
            background: #e93434;
            color: #ffffff;
        }
        
        h1 {
	        text-align: center;
        }

        /* The popup form - hidden by default */
        .form-popup {
        display: true;
        position: fixed;
        right: 30%;
        left: 30%;
        top: 30%;
        border: 3px solid #f1f1f1;
        z-index: 9;
        }

        /* Add styles to the form container */
        .form-container {
        padding: 10px;
        background-color: white;
        vertical-align: middle;
        right: 30%;
        left: 30%;
        top: 30%;
        }


        /* Set a style for the submit/login button */
        .form-container .btn {
        background-color: navy;
        color: white;
        padding: 16px 20px;
        border: none;
        cursor: pointer;
        width: 100%;
        height: 100%;
        margin-bottom:10px;
        opacity: 0.8;
        vertical-align: middle;
        font-size: 16px;
        }

        /* Add some hover effects to buttons */
        .form-container .btn:hover, .open-button:hover {
        opacity: 1;
        }

    </style>
</head>

<body>
    <div class="form-popup" id="myForm">
        <div class="form-container">
          <h1>NHS Scotland Service Finder</h1>
          <h4>Please choose which service you are looking for today</h4>
          <button type="button" class="btn GPs"><onclick="closeForm()">General Practitioner</button>
          <button type="button" class="btn Dentist"><onclick="closeForm()">Dentist</button>
          <button type="button" class="btn Optician"><onclick="closeForm()">Optician</button>
          <button type="button" class="btn Pharmacy"><onclick="closeForm()">Pharmacy</button>
          <button type="button" class="btn Hospital"><onclick="closeForm()">Hospital</button>
          <button type="button" class="btn SHClinic"><onclick="closeForm()">Sexual Health Clinic</button>
        </div>
    </div>
      
    <div id="sidebar" class="sidebar collapsed">
        
        <!-- Nav tabs -->
        <div class="sidebar-tabs">
            <ul role="tablist">
                <li><a href="#home" role="tab"><i class="fa fa-info"></i></a></li>
                <li><a href="#GPs" role="tab"><i class="fa fa-user-md"></i></a></li>
                <li><a href="#Dentists" role="tab"><i class="fa fa-envelope"></i></a></li>
                <li><a href="https://github.com/Turbo87/sidebar-v2" role="tab" target="_blank"><i class="fa fa-github"></i></a></li>
            </ul>

            <ul role="tablist">
                <li><a href="#settings" role="tab"><i class="fa fa-gear"></i></a></li>
            </ul>
        </div>

        <!-- Tab panes -->
        <div class="sidebar-content">
            <div class="sidebar-pane" id="home">
                <h1 class="sidebar-header">
                    Health Service Finder
                    <span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
                </h1>

                <p>A responsive sidebar for mapping libraries like <a href="http://leafletjs.com/">Leaflet</a> or <a href="http://openlayers.org/">OpenLayers</a>.</p>

            </div>

            <div class="sidebar-pane" id="profile">
                <h1 class="sidebar-header">Profile<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
            </div>

            <div class="sidebar-pane" id="GPs">
                <h1 class="sidebar-header">GPs<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
            </div>

            <div class="sidebar-pane" id="settings">
                <h1 class="sidebar-header">Settings<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
            </div>
        </div>
    </div>

    <div id="map" class="sidebar-map"></div>

    <!–– Reference all sources -->

    <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v0.46.0/mapbox-gl.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/leaflet.js"></script>
    <script src="https://rawgit.com/mapbox/mapbox-gl-leaflet/master/leaflet-mapbox-gl.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/jquery-ui.min.js" type="text/javascript"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script src="https://unpkg.com/leaflet-geosearch@3.0.0/dist/geosearch.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.js" charset="utf-8"></script>
    <script src="Plugins/sidebar-v2/js/leaflet-sidebar.js"></script>



    <script src="2020_07_07_Processed_Pharmacies.js"></script>
    <script src="2020_07_07_Processed_Dentists.js"></script>
    <script src="2020_07_07_Processed_GPs.js"></script>
    <script src="2020_07_07_Processed_Hospitals.js"></script>
    <script src="2020_07_07_Processed_Opticians.js"></script>
    <script src="2020_07_07_Processed_SHClinics.js"></script>
    <script src="ggandc.js"></script>
    <!–– Script for map containing javascript code begins -->

    <script>


        function closeForm() {
        document.getElementById("myForm").style.display = "none";
        }



    // Establish base map using Ordnance Survey Zoomstack, and Mapbox-GL-Leaflet plugin

    var basemapLayers = L.layerGroup();

    var light_basemap = L.mapboxGL({
    style: 'https://s3-eu-west-1.amazonaws.com/tiles.os.uk/v2/styles/open-zoomstack-light/style.json',
    accessToken: 'no-token'
    });

    var night_basemap = L.mapboxGL({
    style: 'https://s3-eu-west-1.amazonaws.com/tiles.os.uk/v2/styles/open-zoomstack-night/style.json',
    accessToken: 'no-token'
    })

    var outdoor_basemap = L.mapboxGL({
    style: 'https://s3-eu-west-1.amazonaws.com/tiles.os.uk/v2/styles/open-zoomstack-outdoor/style.json',
    accessToken: 'no-token'
    })

    var roads_basemap = L.mapboxGL({
    style: 'https://s3-eu-west-1.amazonaws.com/tiles.os.uk/v2/styles/open-zoomstack-road/style.json',
    accessToken: 'no-token'
    })

    var baseMaps = {
        "Light": light_basemap,
        "Night": night_basemap,
        "Outdoors": outdoor_basemap,
        "Road" : roads_basemap
    };

    var Opticians_layer = L.layerGroup(),
        GPs_layer = L.layerGroup(),
        Dentists_layer = L.layerGroup(),
        SHClinics_layer = L.layerGroup(),
        Pharmacies_layer = L.layerGroup(),
        Hospitals_layer = L.layerGroup();


    var map = L.map('map', {
    minZoom: 7,
    maxZoom: 18,
    maxBounds: [[ 49.84 , -8.74 ], [ 60.9, 1.96 ]],
    layers: [outdoor_basemap]
    });


    //map.locate({setView: true, maxZoom: 16});

    //function onLocationFound(e) {
        //var radius = e.accuracy;

        //L.circle(e.latlng).addTo(map)
        //   .bindPopup("You are here").openPopup();

    //}

    //map.on('locationfound', onLocationFound);

    L.Control.geocoder({
        position: 'topleft'
    }).addTo(map);
    map.zoomControl.setPosition('bottomright');
    map.attributionControl.addAttribution('Contains OS data &copy; Crown copyright and database rights 2018');


    map.setView([ 55.8652, -4.45 ], 10);


    var lc = L.control.locate({
        options: {
            circleStyle: {
                fillOpacity: 0
            }       
        }
    }).addTo(map);

    function onLocationfound(e) {
        var user_location = e.latlng;
        console.log(user_location);
    }

    map.on('locationfound', onLocationfound);

    lc.start();

    var GGandC_poly = L.geoJSON(ggandc_polygon, {
        style: {
            "color": "#808080",
            "weight": 2,
            "fill": false
        }
    }).addTo(map);
    // create a function for pop up information 

    var customOptions =
            {
            'maxWidth': '500',
            'className' : 'custom'
            }

    function onEachFeature(feature, layer) {
        layer.bindPopup(feature.properties.Name + "<br>" + feature.properties.Address1 + "<br>" + feature.properties.Postcode + "<br>" + feature.properties.Telephone, customOptions);
    }

    // create a function for styling points and adding them to the map


    function addPoints(service, colour, layerName, figureURL) {

        var mapIcon = L.icon({
            iconUrl: figureURL,
            iconSize: [30, 30],
            iconAnchor: [15,15],
            popupAnchor: [0, -15],
        });

        L.geoJSON(service, {
            onEachFeature: onEachFeature,
            pointToLayer: function (feature, latlng) {
                return L.marker(latlng, {icon: mapIcon});
            }
        }).addTo(layerName);
    }



    addPoints(Opticians, "#ff2200", Opticians_layer, 'MapFigures/Opticians.png')
    addPoints(Dentists, "#66ccff", Dentists_layer, 'MapFigures/Dentists.png')
    addPoints(GPs, "#aa2233", GPs_layer, 'MapFigures/GPs.png')
    addPoints(Hospitals, "#33cc33", Hospitals_layer, 'MapFigures/Hospitals.png')
    addPoints(Pharmacies, "#ffff00", Pharmacies_layer, 'MapFigures/Pharmacies.png')
    addPoints(SHClinics, "#6600cc", SHClinics_layer, 'MapFigures/SHClinics.png')


    var overlayMaps = {
        "Opticians": Opticians_layer,
        "Dentists" : Dentists_layer,
        "GPs": GPs_layer,
        "Hospitals": Hospitals_layer,
        "Pharmacies": Pharmacies_layer,
        "Sexual Health Clinics": SHClinics_layer
    };
        


    L.control.layers(baseMaps).addTo(map);
    L.control.layers(overlayMaps).addTo(map);

    var sidebar = L.control.sidebar('sidebar').addTo(map);




    </script>

    </body>
</html>